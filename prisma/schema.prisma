// Prisma schema for Annual Review app

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ä½¿ç”¨è€… (å°ç€šã€å·§å·§)
model User {
  id        String   @id @default(cuid())
  name      String   @unique // "å°ç€š" or "å·§å·§"
  createdAt DateTime @default(now())

  entries   Entry[]
  reactions Reaction[]
}

// å›æ†¶æˆ–é¡˜æœ›å¡ç‰‡
model Entry {
  id           String    @id @default(cuid())
  userId       String
  user         User      @relation(fields: [userId], references: [id])
  
  type         String    // "MEMORY" or "WISH"
  content      String
  year         Int       // 2025 for memory, 2026 for wish
  imageUrl     String?   // ç…§ç‰‡ç¶²å€ (å¯é¸)
  lockedUntil  DateTime? // é–å®šåˆ°ä»€éº¼æ™‚å€™ (å¯é¸)
  
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  reactions    Reaction[]
}

// è¡¨æƒ…åæ‡‰
model Reaction {
  id        String   @id @default(cuid())
  entryId   String
  entry     Entry    @relation(fields: [entryId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  emoji     String   // "â¤ï¸", "ğŸ¥¹", "ğŸ˜†", "ğŸ«‚" ç­‰
  createdAt DateTime @default(now())

  @@unique([entryId, userId, emoji]) // åŒä¸€äººå°åŒä¸€å¡ç‰‡åªèƒ½æŒ‰ä¸€ç¨®è¡¨æƒ…ä¸€æ¬¡
}
